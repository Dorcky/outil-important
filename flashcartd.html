<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1E2749, #4A5BDE, #7A84E8);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card {
            height: 250px;
            cursor: pointer;
        }
        .card-body {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center text-white mb-4" id="collectionTitle"></h1>
        
        <div class="card mb-4">
            <div class="card-body">
                <h2 class="card-text text-center" id="cardContent"></h2>
            </div>
        </div>

        <div class="d-flex justify-content-center mb-4">
            <button class="btn btn-secondary mx-2" id="prevBtn">Précédent</button>
            <button class="btn btn-primary mx-2" id="flipBtn">Retourner</button>
            <button class="btn btn-secondary mx-2" id="nextBtn">Suivant</button>
        </div>

        <div class="d-flex justify-content-center mb-4">
            <button class="btn btn-success mx-2" id="knownBtn">Je sais</button>
            <button class="btn btn-danger mx-2" id="unknownBtn">Je ne sais pas</button>
        </div>

        <div class="mb-4">
            <input type="range" class="form-range" id="cardSlider">
            <p class="text-center text-white" id="cardCount"></p>
        </div>

        <div class="input-group mb-4">
            <input type="number" class="form-control" id="goToInput" placeholder="Aller à la carte #">
            <button class="btn btn-outline-secondary" type="button" id="goToBtn">Go</button>
        </div>

        <div class="d-flex justify-content-center">
            <button class="btn btn-outline-light mx-2" id="learnUnknownBtn">Apprendre les inconnues</button>
            <button class="btn btn-outline-light mx-2" id="resetAllBtn">Réinitialiser tout</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentCards = [];
        let currentIndex = 0;
        let flipped = false;
        const collection = 'NomDeVotreCollection'; // Remplacez par le nom de votre collection

        const cardContent = document.getElementById('cardContent');
        const cardSlider = document.getElementById('cardSlider');
        const cardCount = document.getElementById('cardCount');

        async function loadCards() {
            try {
                const response = await fetch(`https://flashcard2.onrender.com/api/collections/${encodeURIComponent(collection)}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                currentCards = await response.json();
                currentCards.sort((a, b) => (!a.known && b.known) ? -1 : (a.known && !b.known) ? 1 : 0);
                updateCard();
                updateSlider();
            } catch (error) {
                console.error('Error loading cards:', error);
                alert('Error loading flashcards.');
            }
        }

        function updateCard() {
            cardContent.textContent = flipped ? currentCards[currentIndex].back : currentCards[currentIndex].front;
            cardCount.textContent = `Carte ${currentIndex + 1} / ${currentCards.length}`;
        }

        function updateSlider() {
            cardSlider.min = 0;
            cardSlider.max = currentCards.length - 1;
            cardSlider.value = currentIndex;
        }

        document.getElementById('flipBtn').addEventListener('click', () => {
            flipped = !flipped;
            updateCard();
        });

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
                flipped = false;
                updateCard();
                updateSlider();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentIndex < currentCards.length - 1) {
                currentIndex++;
                flipped = false;
                updateCard();
                updateSlider();
            }
        });

        cardSlider.addEventListener('input', (e) => {
            currentIndex = parseInt(e.target.value);
            flipped = false;
            updateCard();
        });

        document.getElementById('goToBtn').addEventListener('click', () => {
            const goToIndex = parseInt(document.getElementById('goToInput').value) - 1;
            if (goToIndex >= 0 && goToIndex < currentCards.length) {
                currentIndex = goToIndex;
                flipped = false;
                updateCard();
                updateSlider();
            } else {
                alert('Numéro de carte invalide');
            }
        });

        async function updateCardStatus(known) {
            if (currentCards.length === 0) return;

            const card = currentCards[currentIndex];
            try {
                await fetch(`https://flashcard2.onrender.com/api/flashcards/${card._id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ known, reviewed: true }),
                });
                card.known = known;
                card.reviewed = true;

                if (currentIndex < currentCards.length - 1) {
                    currentIndex++;
                    flipped = false;
                    updateCard();
                    updateSlider();
                }
            } catch (error) {
                console.error('Error updating card status:', error);
            }
        }

        document.getElementById('knownBtn').addEventListener('click', () => updateCardStatus(true));
        document.getElementById('unknownBtn').addEventListener('click', () => updateCardStatus(false));

        document.getElementById('learnUnknownBtn').addEventListener('click', () => {
            const unknownCards = currentCards.filter(card => !card.known);
            if (unknownCards.length === 0) {
                alert('Toutes les cartes sont marquées comme connues !');
            } else {
                currentCards = unknownCards;
                currentIndex = 0;
                flipped = false;
                updateCard();
                updateSlider();
            }
        });

        document.getElementById('resetAllBtn').addEventListener('click', async () => {
            try {
                await Promise.all(currentCards.map(async (card) => {
                    await fetch(`https://flashcard2.onrender.com/api/flashcards/${card._id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ known: false, reviewed: false }),
                    });
                    card.known = false;
                    card.reviewed = false;
                }));
                currentIndex = 0;
                flipped = false;
                updateCard();
                updateSlider();
                alert('Toutes les cartes ont été réinitialisées !');
            } catch (error) {
                console.error('Error resetting cards:', error);
                alert('Erreur lors de la réinitialisation des cartes');
            }
        });

        document.getElementById('collectionTitle').textContent = collection;
        loadCards();
    </script>
</body>
</html>